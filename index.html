<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ MoneyTracker - –£—á–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .stat-card.income { border-left: 5px solid #27ae60; }
        .stat-card.expense { border-left: 5px solid #e74c3c; }
        .stat-amount {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .balance {
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            color: #2c3e50;
        }
        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }
        .main-content {
            padding: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .category-btn {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .category-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        .transactions {
            margin-top: 30px;
        }
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.3s;
        }
        .transaction-item:hover {
            background: #f8f9fa;
        }
        .transaction-info {
            flex: 1;
        }
        .transaction-amount {
            font-weight: bold;
            font-size: 1.2em;
        }
        .income-amount { color: #27ae60; }
        .expense-amount { color: #e74c3c; }
        .transaction-category {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
        }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .tab.active {
            background: #667eea;
            color: white;
        }
        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .export-btn {
            background: #27ae60;
            margin-top: 10px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ MoneyTracker</h1>
            <p>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É—á–µ—Ç–∞ –≤–∞—à–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤</p>
        </div>

        <div class="stats">
            <div class="stat-card income">
                <div>–î–æ—Ö–æ–¥—ã</div>
                <div class="stat-amount" id="totalIncome">0 ‚ÇΩ</div>
                <div>–∑–∞ –≤—Å–µ –≤—Ä–µ–º—è</div>
            </div>
            <div class="stat-card expense">
                <div>–†–∞—Å—Ö–æ–¥—ã</div>
                <div class="stat-amount" id="totalExpense">0 ‚ÇΩ</div>
                <div>–∑–∞ –≤—Å–µ –≤—Ä–µ–º—è</div>
            </div>
        </div>

        <div class="balance">
            <span id="balanceAmount" class="positive">0 ‚ÇΩ</span>
        </div>

        <div class="main-content">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('add')">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</div>
                <div class="tab" onclick="switchTab('history')">–ò—Å—Ç–æ—Ä–∏—è</div>
                <div class="tab" onclick="switchTab('analytics')">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
            <div id="addTab">
                <div class="form-group">
                    <label>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏:</label>
                    <select id="type" class="form-control">
                        <option value="income">–î–æ—Ö–æ–¥</option>
                        <option value="expense">–†–∞—Å—Ö–æ–¥</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–°—É–º–º–∞ (‚ÇΩ):</label>
                    <input type="number" id="amount" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" min="0" step="0.01">
                </div>

                <div class="form-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <div class="categories" id="categories">
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>

                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <input type="text" id="description" class="form-control" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ">
                </div>

                <div class="form-group">
                    <label>–î–∞—Ç–∞:</label>
                    <input type="date" id="date" class="form-control">
                </div>

                <button class="btn" onclick="addTransaction()">üíæ –î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</button>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ -->
            <div id="historyTab" class="hidden">
                <div class="form-group">
                    <input type="text" id="search" class="form-control" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é..." onkeyup="filterTransactions()">
                </div>
                <div class="transactions" id="transactionsList">
                    <!-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                <button class="btn export-btn" onclick="exportData()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
            <div id="analyticsTab" class="hidden">
                <div class="chart-container">
                    <h3>üìà –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                    <canvas id="chart" width="400" height="200"></canvas>
                </div>
                <div class="form-group">
                    <label>–ü–µ—Ä–∏–æ–¥:</label>
                    <select id="period" class="form-control" onchange="updateChart()">
                        <option value="week">–ù–µ–¥–µ–ª—è</option>
                        <option value="month" selected>–ú–µ—Å—è—Ü</option>
                        <option value="year">–ì–æ–¥</option>
                        <option value="all">–í—Å–µ –≤—Ä–µ–º—è</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let selectedCategory = '';

        // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –¥–æ—Ö–æ–¥–æ–≤
        const categories = {
            income: ['–ó–∞—Ä–ø–ª–∞—Ç–∞', '–§—Ä–∏–ª–∞–Ω—Å', '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', '–ü–æ–¥–∞—Ä–∫–∏', '–ü—Ä–æ—á–µ–µ'],
            expense: ['–ï–¥–∞', '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', '–ñ–∏–ª—å–µ', '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', '–ó–¥–æ—Ä–æ–≤—å–µ', '–û–¥–µ–∂–¥–∞', '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', '–ü—Ä–æ—á–µ–µ']
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function init() {
            renderCategories();
            updateStats();
            renderTransactions();
            updateChart();
            document.getElementById('date').valueAsDate = new Date();
        }

        // –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function renderCategories() {
            const categoriesDiv = document.getElementById('categories');
            const type = document.getElementById('type').value;
            
            categoriesDiv.innerHTML = '';
            categories[type].forEach(category => {
                const btn = document.createElement('div');
                btn.className = 'category-btn';
                btn.textContent = category;
                btn.onclick = () => selectCategory(btn, category);
                categoriesDiv.appendChild(btn);
            });
        }

        // –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function selectCategory(btn, category) {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            selectedCategory = category;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('[id$="Tab"]').forEach(tab => tab.classList.add('hidden'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            if (tabName === 'analytics') {
                updateChart();
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        function addTransaction() {
            const amount = parseFloat(document.getElementById('amount').value);
            const description = document.getElementById('description').value;
            const type = document.getElementById('type').value;
            const date = document.getElementById('date').value;

            if (!amount || !selectedCategory || !description) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            const transaction = {
                id: Date.now(),
                amount: amount,
                description: description,
                category: selectedCategory,
                type: type,
                date: date,
                timestamp: new Date().toISOString()
            };

            transactions.push(transaction);
            saveTransactions();
            updateStats();
            renderTransactions();
            
            // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
            document.getElementById('amount').value = '';
            document.getElementById('description').value = '';
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            selectedCategory = '';
            
            alert('–û–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ LocalStorage
        function saveTransactions() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const balance = totalIncome - totalExpense;

            document.getElementById('totalIncome').textContent = formatMoney(totalIncome);
            document.getElementById('totalExpense').textContent = formatMoney(totalExpense);
            document.getElementById('balanceAmount').textContent = formatMoney(balance);
            document.getElementById('balanceAmount').className = balance >= 0 ? 'positive' : 'negative';
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        function renderTransactions() {
            const list = document.getElementById('transactionsList');
            list.innerHTML = '';

            const sortedTransactions = transactions.sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedTransactions.forEach(transaction => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="transaction-info">
                        <div>${transaction.description}</div>
                        <div class="transaction-category">${transaction.category} ‚Ä¢ ${formatDate(transaction.date)}</div>
                    </div>
                    <div class="transaction-amount ${transaction.type}-amount">
                        ${transaction.type === 'income' ? '+' : '-'}${formatMoney(transaction.amount)}
                    </div>
                    <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
                `;
                list.appendChild(item);
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        function deleteTransaction(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –æ–ø–µ—Ä–∞—Ü–∏—é?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveTransactions();
                updateStats();
                renderTransactions();
                updateChart();
            }
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        function filterTransactions() {
            const search = document.getElementById('search').value.toLowerCase();
            const items = document.querySelectorAll('.transaction-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? 'flex' : 'none';
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
        function updateChart() {
            const canvas = document.getElementById('chart');
            const ctx = canvas.getContext('2d');
            const period = document.getElementById('period').value;
            
            // –û—á–∏—Å—Ç–∫–∞ canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–µ—Ä–∏–æ–¥—É
            const filteredTransactions = filterTransactionsByPeriod(period);
            const expenseByCategory = {};
            
            filteredTransactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                });
            
            // –†–∏—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
            const categories = Object.keys(expenseByCategory);
            const amounts = Object.values(expenseByCategory);
            const maxAmount = Math.max(...amounts, 1);
            
            const barWidth = 40;
            const spacing = 20;
            const startX = 50;
            const startY = canvas.height - 50;
            const maxBarHeight = 150;
            
            // –û—Å–∏
            ctx.strokeStyle = '#ccc';
            ctx.beginPath();
            ctx.moveTo(30, 20);
            ctx.lineTo(30, startY);
            ctx.lineTo(canvas.width - 20, startY);
            ctx.stroke();
            
            // –°—Ç–æ–ª–±—Ü—ã
            categories.forEach((category, index) => {
                const x = startX + index * (barWidth + spacing);
                const barHeight = (amounts[index] / maxAmount) * maxBarHeight;
                const y = startY - barHeight;
                
                // –°—Ç–æ–ª–±–µ—Ü
                ctx.fillStyle = getCategoryColor(category);
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // –ü–æ–¥–ø–∏—Å—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(category, x, startY + 20);
                
                // –°—É–º–º–∞
                ctx.fillText(formatMoney(amounts[index]), x, y - 5);
            });
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–µ—Ä–∏–æ–¥—É
        function filterTransactionsByPeriod(period) {
            const now = new Date();
            let startDate;
            
            switch (period) {
                case 'week':
                    startDate = new Date(now.setDate(now.getDate() - 7));
                    break;
                case 'month':
                    startDate = new Date(now.setMonth(now.getMonth() - 1));
                    break;
                case 'year':
                    startDate = new Date(now.setFullYear(now.getFullYear() - 1));
                    break;
                default:
                    return transactions;
            }
            
            return transactions.filter(t => new Date(t.date) >= startDate);
        }

        // –¶–≤–µ—Ç–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function getCategoryColor(category) {
            const colors = {
                '–ï–¥–∞': '#e74c3c', '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç': '#3498db', '–ñ–∏–ª—å–µ': '#9b59b6',
                '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è': '#f39c12', '–ó–¥–æ—Ä–æ–≤—å–µ': '#2ecc71', '–û–¥–µ–∂–¥–∞': '#e67e22',
                '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ': '#1abc9c', '–ü—Ä–æ—á–µ–µ': '#95a5a6'
            };
            return colors[category] || '#95a5a6';
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            let csv = '–î–∞—Ç–∞,–¢–∏–ø,–ö–∞—Ç–µ–≥–æ—Ä–∏—è,–û–ø–∏—Å–∞–Ω–∏–µ,–°—É–º–º–∞\n';
            
            transactions.forEach(t => {
                csv += `${t.date},${t.type === 'income' ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥'},${t.category},${t.description},${t.amount}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'money_tracker_export.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function formatMoney(amount) {
            return new Intl.NumberFormat('ru-RU', { 
                style: 'currency', 
                currency: 'RUB',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('ru-RU');
        }

        // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('type').addEventListener('change', renderCategories);

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
